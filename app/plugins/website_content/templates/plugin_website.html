<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Website Content Plugin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
{% include '_nav.html' %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-0">Website Content Plugin</h3>
      <small class="text-muted">Control headline, hero image, and podcast embeds for the public site.</small>
    </div>
    <div class="text-end">
      <div class="mb-2">
        {% if plugin.enabled %}
          <span class="badge bg-success">Enabled</span>
        {% else %}
          <span class="badge bg-secondary">Disabled</span>
        {% endif %}
      </div>
      <form method="post" action="{{ url_for('main.toggle_plugin', name='website_content') }}" class="d-inline">
        <button class="btn btn-sm btn-outline-primary" type="submit">{{ 'Disable' if plugin.enabled else 'Enable' }}</button>
      </form>
      <a class="btn btn-sm btn-secondary" href="{{ url_for('main.plugins_home') }}">Back</a>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header">Front Page Hero (keeps legacy fields in sync with first article)</div>
    <div class="card-body">
      <form method="post">
        <input type="hidden" name="action" value="save_content">
        <div class="mb-3">
          <label class="form-label">Headline</label>
          <input type="text" name="headline" class="form-control" value="{{ content.headline or '' }}" placeholder="Front page headline">
        </div>
        <div class="mb-3">
          <label class="form-label">Body</label>
          <textarea name="body" rows="4" class="form-control" placeholder="Front page body copy">{{ content.body or '' }}</textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Image URL</label>
          <input type="text" name="image_url" class="form-control" value="{{ content.image_url or '' }}" placeholder="https://...">
          <small class="text-muted">Provide a full URL to the hero image used on the website.</small>
        </div>
        <button class="btn btn-primary" type="submit">Save Hero</button>
      </form>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Banner Message</span>
      <small class="text-muted">Shown site-wide when set.</small>
    </div>
    <div class="card-body">
      <form method="post" class="row g-3 align-items-end">
        <input type="hidden" name="action" value="save_banner">
        <div class="col-md-5">
          <label class="form-label">Message</label>
          <input type="text" name="banner_message" class="form-control" value="{{ banner.message if banner else '' }}" placeholder="Stream maintenance tonight 11pm–12am">
        </div>
        <div class="col-md-4">
          <label class="form-label">Link (optional)</label>
          <input type="text" name="banner_link" class="form-control" value="{{ banner.link if banner else '' }}" placeholder="https://...">
        </div>
        <div class="col-md-2">
          <label class="form-label">Tone</label>
          <select name="banner_tone" class="form-select">
            <option value="" {% if not banner or not banner.tone %}selected{% endif %}>Default</option>
            <option value="info" {% if banner and banner.tone=='info' %}selected{% endif %}>Info</option>
            <option value="success" {% if banner and banner.tone=='success' %}selected{% endif %}>Success</option>
            <option value="warning" {% if banner and banner.tone=='warning' %}selected{% endif %}>Warning</option>
            <option value="danger" {% if banner and banner.tone=='danger' %}selected{% endif %}>Danger</option>
          </select>
        </div>
        <div class="col-md-1 text-end">
          <button class="btn btn-primary w-100" type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Articles (ordered)</span>
      <small class="text-muted">First article is the hero on the public site.</small>
    </div>
    <div class="card-body">
      <form method="post" class="row g-3 mb-3">
        <input type="hidden" name="action" value="add_article">
        <div class="col-md-3">
          <label class="form-label">Title</label>
          <input type="text" name="article_title" class="form-control" required>
        </div>
        <div class="col-md-5">
          <label class="form-label">Body</label>
          <textarea name="article_body" class="form-control" rows="2" placeholder="Summary or body"></textarea>
        </div>
        <div class="col-md-3">
          <label class="form-label">Image URL</label>
          <input type="text" name="article_image" class="form-control" placeholder="https://...">
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <button class="btn btn-success w-100" type="submit">Add</button>
        </div>
      </form>

      {% if articles %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Image</th>
              <th class="w-50">Body</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for art in articles %}
            <tr>
              <td class="text-muted">{{ art.position }}</td>
              <td class="fw-semibold">{{ art.title }}</td>
              <td class="small">{{ art.image_url or '' }}</td>
              <td class="small">{{ art.body or '' }}</td>
              <td class="text-end">
                <form method="post" class="d-inline">
                  <input type="hidden" name="action" value="move_article">
                  <input type="hidden" name="article_id" value="{{ art.id }}">
                  <input type="hidden" name="direction" value="up">
                  <button class="btn btn-sm btn-outline-secondary" type="submit">↑</button>
                </form>
                <form method="post" class="d-inline">
                  <input type="hidden" name="action" value="move_article">
                  <input type="hidden" name="article_id" value="{{ art.id }}">
                  <input type="hidden" name="direction" value="down">
                  <button class="btn btn-sm btn-outline-secondary" type="submit">↓</button>
                </form>
                <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#edit-art-{{ art.id }}">Edit</button>
                <form method="post" class="d-inline">
                  <input type="hidden" name="action" value="delete_article">
                  <input type="hidden" name="article_id" value="{{ art.id }}">
                  <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                </form>
              </td>
            </tr>
            <tr class="collapse" id="edit-art-{{ art.id }}">
              <td colspan="5">
                <form method="post" class="row g-2">
                  <input type="hidden" name="action" value="update_article">
                  <input type="hidden" name="article_id" value="{{ art.id }}">
                  <div class="col-md-3">
                    <label class="form-label small mb-1">Title</label>
                    <input type="text" class="form-control form-control-sm" name="article_title" value="{{ art.title }}">
                  </div>
                  <div class="col-md-5">
                    <label class="form-label small mb-1">Body</label>
                    <textarea class="form-control form-control-sm" name="article_body" rows="2">{{ art.body or '' }}</textarea>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label small mb-1">Image URL</label>
                    <input type="text" class="form-control form-control-sm" name="article_image" value="{{ art.image_url or '' }}">
                  </div>
                  <div class="col-md-1 d-flex align-items-end">
                    <button class="btn btn-sm btn-primary w-100" type="submit">Save</button>
                  </div>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-muted mb-0">No articles yet. Add one above.</p>
      {% endif %}
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Press Features</span>
      <small class="text-muted">Optional links to external coverage.</small>
    </div>
    <div class="card-body">
      <form method="post" class="row g-3 mb-3">
        <input type="hidden" name="action" value="add_press">
        <div class="col-md-3">
          <label class="form-label">Name</label>
          <input type="text" name="press_name" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">URL</label>
          <input type="text" name="press_url" class="form-control" placeholder="https://..." required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Logo URL (optional)</label>
          <input type="text" name="press_logo" class="form-control" placeholder="https://...">
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <button class="btn btn-success w-100" type="submit">Add</button>
        </div>
      </form>

      {% if press %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>URL</th>
              <th>Logo</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for feat in press %}
            <tr>
              <td class="text-muted">{{ feat.position }}</td>
              <td class="fw-semibold">{{ feat.name }}</td>
              <td class="small">{{ feat.url }}</td>
              <td class="small">{{ feat.logo or '' }}</td>
              <td class="text-end">
                <form method="post" class="d-inline">
                  <input type="hidden" name="action" value="move_press">
                  <input type="hidden" name="press_id" value="{{ feat.id }}">
                  <input type="hidden" name="direction" value="up">
                  <button class="btn btn-sm btn-outline-secondary" type="submit">↑</button>
                </form>
                <form method="post" class="d-inline">
                  <input type="hidden" name="action" value="move_press">
                  <input type="hidden" name="press_id" value="{{ feat.id }}">
                  <input type="hidden" name="direction" value="down">
                  <button class="btn btn-sm btn-outline-secondary" type="submit">↓</button>
                </form>
                <form method="post" class="d-inline">
                  <input type="hidden" name="action" value="delete_press">
                  <input type="hidden" name="press_id" value="{{ feat.id }}">
                  <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-muted mb-0">No press features yet.</p>
      {% endif %}
    </div>
  </div>

  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>Podcasts</span>
      <span class="text-muted">Embed codes from iHeart or other platforms.</span>
    </div>
    <div class="card-body">
      <form method="post" class="row g-3 mb-4">
        <input type="hidden" name="action" value="add_podcast">
        <div class="col-md-4">
          <label class="form-label">Title</label>
          <input type="text" name="podcast_title" class="form-control" placeholder="Podcast title" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Description (optional)</label>
          <input type="text" name="podcast_description" class="form-control" placeholder="Short description">
        </div>
        <div class="col-md-4">
          <label class="form-label">Embed Code</label>
          <textarea name="podcast_embed" class="form-control" rows="2" placeholder="Paste embed HTML" required></textarea>
        </div>
        <div class="col-12 text-end">
          <button class="btn btn-success" type="submit">Add Podcast</button>
        </div>
      </form>

      {% if podcasts %}
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Embed Preview</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for pod in podcasts %}
                <tr>
                  <td class="fw-semibold">{{ pod.title }}</td>
                  <td>{{ pod.description or '' }}</td>
                  <td><code class="small">{{ pod.embed_code[:80] }}{% if pod.embed_code|length > 80 %}...{% endif %}</code></td>
                  <td class="text-end">
                    <form method="post" class="d-inline">
                      <input type="hidden" name="action" value="delete_podcast">
                      <input type="hidden" name="podcast_id" value="{{ pod.id }}">
                      <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted mb-0">No podcasts added yet.</p>
      {% endif %}
    </div>
  </div>
</div>
{% include '_footer.html' %}
</body>
</html>
