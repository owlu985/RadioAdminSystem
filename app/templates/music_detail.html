<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Track Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
{% include '_nav.html' %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">Track Detail</h3>
        <div class="d-flex gap-2">
            <a class="btn btn-outline-secondary btn-sm" href="/music/search">Back to search</a>
            {% if track %}
            <a class="btn btn-outline-info btn-sm" href="/music/cue?path={{ track.path|urlencode }}">CUE Editor</a>
            <a class="btn btn-primary btn-sm" href="/music/edit?path={{ track.path|urlencode }}">Edit</a>
            {% endif %}
        </div>
    </div>
    {% if track %}
    <div class="row g-3">
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body text-center">
                    {% if track.cover_embedded %}
                        <img src="/music/cover?path={{ track.path|urlencode }}" alt="cover" class="img-fluid rounded mb-3" style="max-height:260px;">
                    {% elif track.cover_path %}
                        <img src="/music/stream?path={{ track.cover_path|urlencode }}" alt="cover" class="img-fluid rounded mb-3" style="max-height:260px;">
                    {% else %}
                        <div class="text-muted mb-3">No cover art</div>
                    {% endif %}
                    <audio controls preload="none" class="w-100" src="/music/stream?path={{ track.path|urlencode }}"></audio>
                </div>
            </div>
            {% set preview = track.peaks_preview if track.peaks_preview is defined else None %}
            {% if preview %}
            <div class="card mt-3">
                <div class="card-header">Waveform Preview</div>
                <div class="card-body">
                    <div class="d-flex align-items-end" style="gap:2px; height:90px;">
                        {% for p in preview %}
                        <div style="width:3px; background:#0d6efd; height:{{ (p|float * 90)|round(0,'floor') }}px"></div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <div class="row g-2 small">
                        <div class="col-md-6"><strong>Title:</strong> {{ track.title }}</div>
                        <div class="col-md-6"><strong>Artist:</strong> {{ track.artist }}</div>
                        <div class="col-md-6"><strong>Album:</strong> {{ track.album }}</div>
                        <div class="col-md-6"><strong>Composer:</strong> {{ track.composer }}</div>
                        <div class="col-md-6"><strong>ISRC:</strong> {{ track.isrc }}</div>
                        <div class="col-md-6"><strong>Year:</strong> {{ track.year }}</div>
                        <div class="col-md-6"><strong>Disc/Track:</strong> {{ track.disc }} / {{ track.track }}</div>
                        <div class="col-md-6"><strong>Copyright:</strong> {{ track.copyright }}</div>
                        <div class="col-md-6"><strong>Duration:</strong> {{ track.duration_seconds }}s</div>
                        <div class="col-md-6"><strong>Peak / RMS:</strong> {{ track.peak_db }} / {{ track.rms_db }}</div>
                        <div class="col-md-6"><strong>Bitrate:</strong> {{ track.bitrate }}</div>
                        <div class="col-12"><strong>Path:</strong> {{ track.path }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
        <p>Track not found.</p>
    {% endif %}
</div>
</body>
{% include '_footer.html' %}
</html>
