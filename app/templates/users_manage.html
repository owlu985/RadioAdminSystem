{% extends 'base.html' %}
{% block title %}Users{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h2 class="mb-0">User Access</h2>
  <span class="text-muted">OAuth-only accounts; approve and assign roles</span>
</div>
<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Provider</th>
      <th>Role</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for user in users %}
    <tr>
      <td>
        <form class="d-flex flex-column gap-1" method="post">
          <input type="hidden" name="user_id" value="{{ user.id }}">
          <input type="text" class="form-control form-control-sm" name="display_name" value="{{ user.display_name or '' }}" placeholder="Display name">
      </td>
      <td class="small">{{ user.email }}</td>
      <td class="small text-muted">{{ user.provider|capitalize }}</td>
      <td>
          <select name="role" class="form-select form-select-sm">
            <option value="" {% if not user.role %}selected{% endif %}>Unset</option>
            {% for value,label in role_choices %}
              <option value="{{ value }}" {% if user.role==value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
      </td>
      <td>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="approved" id="approve_{{ user.id }}" {% if user.approved %}checked{% endif %}>
          <label class="form-check-label" for="approve_{{ user.id }}">Approved</label>
        </div>
        <div class="text-muted small">
          Requested {{ user.requested_at.strftime('%Y-%m-%d') if user.requested_at else 'n/a' }}
          {% if user.approved_at %}<br>Approved {{ user.approved_at.strftime('%Y-%m-%d') }}{% endif %}
        </div>
      </td>
      <td>
        <button type="submit" class="btn btn-sm btn-primary">Save</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="6" class="text-center text-muted">No users yet. Pending OAuth requests will appear here.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
