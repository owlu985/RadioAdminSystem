<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>DJ Music Library</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
{% include '_nav.html' %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
        <div>
            <h3 class="mb-0">DJ Music Library</h3>
            <div class="text-muted">Browse artists or genres, search by title/artist/album, and build playlists from Spotify.</div>
        </div>
        <div class="text-muted small">Results update live from the music library index.</div>
    </div>

    <div class="card mb-4">
        <div class="card-header">Search the library</div>
        <div class="card-body">
            <div class="row g-2 align-items-center">
                <div class="col-md-8">
                    <input type="search" class="form-control" id="djLibrarySearch" placeholder="Search by title, artist, or album">
                </div>
                <div class="col-md-4 text-md-end text-muted small" id="searchMeta">
                    Type at least 2 characters to search.
                </div>
            </div>
            <div class="table-responsive mt-3">
                <table class="table table-sm align-middle">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Artist</th>
                            <th>Album</th>
                            <th>Genre</th>
                            <th>Year</th>
                        </tr>
                    </thead>
                    <tbody id="searchResults">
                        <tr><td colspan="5" class="text-muted">No results yet.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs" id="djLibraryTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="artists-tab" data-bs-toggle="tab" data-bs-target="#artistsTab" type="button" role="tab">Artists</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="genres-tab" data-bs-toggle="tab" data-bs-target="#genresTab" type="button" role="tab">Genres</button>
        </li>
    </ul>
    <div class="tab-content border border-top-0 p-3 mb-4">
        <div class="tab-pane fade show active" id="artistsTab" role="tabpanel">
            <div class="row g-3">
                <div class="col-lg-4">
                    <input type="search" class="form-control mb-2" id="artistFilter" placeholder="Filter artists">
                    <div id="artistList" class="list-group small" style="max-height: 420px; overflow-y: auto;"></div>
                </div>
                <div class="col-lg-8">
                    <div id="artistDetail" class="border rounded bg-light p-3 text-muted">Select an artist to view albums and tracks.</div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="genresTab" role="tabpanel">
            <div class="row g-3">
                <div class="col-lg-4">
                    <input type="search" class="form-control mb-2" id="genreFilter" placeholder="Filter genres">
                    <div id="genreList" class="list-group small" style="max-height: 420px; overflow-y: auto;"></div>
                </div>
                <div class="col-lg-8">
                    <div id="genreDetail" class="border rounded bg-light p-3 text-muted">Select a genre to view tracks.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">Playlist import & conversion</div>
        <div class="card-body">
            <p class="text-muted">
                Paste a text list (Artist - Title) or upload a .txt file to match tracks against the RAMS library.
                If you have a Spotify or YouTube playlist, use TuneMyMusic to export a text file first:
                <a href="https://www.tunemymusic.com/transfer/spotify-to-file" target="_blank" rel="noopener">Spotify → file</a>
                or
                <a href="https://www.tunemymusic.com/transfer/youtube-to-file" target="_blank" rel="noopener">YouTube → file</a>.
            </p>
            <div class="row g-3">
                <div class="col-lg-7">
                    <label class="form-label">Paste playlist text (Artist - Title)</label>
                    <textarea class="form-control font-monospace" id="playlistInput" rows="8" placeholder="Artist - Title"></textarea>
                    <div class="d-flex flex-wrap gap-2 mt-2">
                        <input type="file" class="form-control form-control-sm" id="playlistFile" accept=".txt">
                        <button class="btn btn-primary btn-sm" id="playlistConvert" type="button">Convert Text Playlist</button>
                    </div>
                    <div id="playlistStatus" class="text-muted small mt-2"></div>
                </div>
                <div class="col-lg-5">
                    <label class="form-label">YouTube playlist URL</label>
                    <input type="url" class="form-control" id="youtubeUrl" placeholder="https://www.youtube.com/playlist?list=...">
                    <button class="btn btn-outline-primary btn-sm mt-2" id="youtubeConvert" type="button">Convert YouTube Playlist</button>
                    <div id="youtubeStatus" class="text-muted small mt-2"></div>
                </div>
            </div>
            <div class="row g-3 mt-3">
                <div class="col-lg-7">
                    <h6>Matched tracks</h6>
                    <div class="table-responsive">
                        <table class="table table-sm align-middle">
                            <thead>
                                <tr>
                                    <th>Input</th>
                                    <th>RAMS Match</th>
                                    <th>Score</th>
                                </tr>
                            </thead>
                            <tbody id="playlistMatches">
                                <tr><td colspan="3" class="text-muted">No playlist loaded yet.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-lg-5">
                    <h6>Missing tracks</h6>
                    <ul class="list-group list-group-flush small" id="playlistMissing">
                        <li class="list-group-item text-muted">No missing tracks reported yet.</li>
                    </ul>
                </div>
            </div>
            <div class="mt-3">
                <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2">
                    <h6 class="mb-0">Generated playlist file (plain text)</h6>
                    <button class="btn btn-outline-secondary btn-sm" type="button" id="playlistSave">Save Playlist File</button>
                </div>
                <textarea class="form-control font-monospace" id="playlistText" rows="8" readonly></textarea>
                <div id="playlistSaveStatus" class="text-muted small mt-2"></div>
            </div>
        </div>
    </div>
</div>
{% include '_footer.html' %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/dj_library.js') }}"></script>
</body>
</html>
